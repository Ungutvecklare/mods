-- author: DD ModPassion
-- date: 22.11.2021
-- copyright (C): DD ModPassion, All Rights Reserved
-- version: Farming Simulator 22
local modDirectory = g_currentModDirectory or "unknown" local modName = g_currentModName function injectSpecialization() local modDesc = loadXMLFile("ModFile", modDirectory.."modDesc.xml") for vehicleName, vehicleType in pairs(g_vehicleTypeManager.types) do local numSpec = 0 while true do local baseKey = string.format("modDesc.specializations.") local specKey = string.format(baseKey.."specialization(%s)", numSpec) if not hasXMLProperty(modDesc, specKey) then break end local valPre = 0 local numPre = 0 while true do local preKey = string.format(specKey..".prerequisitesPresent(%d)", numPre) if not hasXMLProperty(modDesc, preKey) then break end local namePre = getXMLString(modDesc, preKey.."#name") local value = getXMLBool(modDesc, preKey.."#value") if value and vehicleType.specializationsByName[namePre] ~= nil then valPre = valPre + 1 elseif not value and vehicleType.specializationsByName[namePre] == nil then valPre = valPre + 1 end numPre = numPre + 1 end local nameSpec = modName.."."..getXMLString(modDesc, specKey.."#name") if valPre == numPre and valPre > 0 and not SpecializationUtil.hasSpecialization(nameSpec, vehicleType.specializations) then g_vehicleTypeManager:addSpecialization(vehicleName, nameSpec) Logging.info("Mod: '%s' Added specialization '%s' for vehicle type = '%s'", modName, nameSpec, vehicleName) end numSpec = numSpec + 1 end end delete(modDesc) end TypeManager.validateTypes = Utils.appendedFunction(TypeManager.validateTypes, function(self) if self.typeName == "vehicle" then injectSpecialization() end end)